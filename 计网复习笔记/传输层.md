# 传输层

传输层存在的基本理由：**进程**到**进程**的传递。

（网络层不对数据报分组进行排序）
$$
传输层的协议的类型\begin{cases}UDP：简单的协议\\TCP：复杂的传输层协议\\SCTP：为多媒体这样的多接口与多流应用而设计\end{cases}
$$

## 1. 进程到进程的传递

需求：

- 数据链路层：相邻节点之间的帧传递——节点到节点的传递  node - to - node delivery
- 网络层：两台主机之间的数据包交换——主机到主机的传递  host - to - host delivery

实际的通信发生在两个进程之间，我们需要进程到进程的传递。

但是任何时刻，源主机上运行着多个进程，并在目的主机上也运行着多个进程。需要某种机制，将源主机上的某个进程的数据传输到目的主机上的对应进程上。

<img src="https://cdn.jsdelivr.net/gh/Holmes233666/gitee-image@main/pictureStore/image-20211208153902282.png" alt="image-20211208153902282" style="zoom:50%;" />

### 1.1 客户机/服务器模式 Client/Server Paradigm

实现进程到进程间通信的方式：两个进程以客户**client/server**的方式进行通信。

**客户机client**：本地主机上的进程称为client，通常需要来自远程主机上的进程提供的服务。

**服务器server**：远程的主机称为服务器。

这两个进程（客户机和服务器）有着相同的名字。

e.g. 客户机从远程机器上获取日期和时间，需要在本地主机上运行Daytime客户进程和远程机器上运行Daytime服务进程。

目前OS支持多用户和多程序运行的环境。一个远程计算机在同一时间可以运行多个服务器程序。

我们必须定义：

- 本地主机   local host
- 本地进程   local process
- 远程主机   remote host
- 远程进程   remote process

#### 1.1.1 寻址

需要传送消息到多个目的地之一的某个特定目的地时，需要一个地址。

##### 1.1.1.1 数据链路层的寻址

如果不是点到点连接（点到多点），那么需要一个MAC地址从多个节点中选择一个节点。数据链路层的帧需要：

- 一个**目的端MAC地址**用于**传送数据**
- 一个**源地址用于下一节点的回答**

##### 1.1.1.2 网络层的寻址

网络层，需要一个IP地址来选择百万主机中的一个主机。

- 网络层中的数据报需要一个目的IP地址用来传送数据
- 需要源IP地址用来接收目的主机的回答

##### 1.1.1.3 传输层

**端口号 port number**：传输层地址，利用这一地址从目的主机上运行的多个进程中选择相应的进程。

- 目的端口号用于传送
- 源端口号用于接收回答

端口号为0~65535之间的**16位整数**

#### 1.1.2 临时端口号与熟知端口号

客户机的端口号（ephemeral port number）：自己定义的，运行在客户机上的传输层软件<u>随机选择</u>，这是**临时端口号（ephemeral port number ）**。

服务器的端口号（well-known port number）：这个端口号不能随机选择。如果随机选择，那么访问这个服务器时将不知道端口号。使用全局端口号——**熟知端口号（well-known port number）**。

当然，有时，一些客户端也被分配了熟知端口号。

<img src="https://cdn.jsdelivr.net/gh/Holmes233666/gitee-image@main/pictureStore/image-20211208162040451.png" alt="image-20211208162040451" style="zoom:50%;" />

#### 1.1.3 IANA范围

端口号地址被IANA划分成三种范围：
$$
端口号地址的范围\begin{cases}Well-known\ \ ports\begin{cases}范围：0--1023\\性质：由IANA分配\end{cases}\\Registered\ \ ports：\begin{cases}范围：1024--49152\\性质：IANA不分配也不控制，可以在IANA注册防止重复\end{cases}\\Dynamic\ \ ports\begin{cases}范围：49152--65535\\性质：不受控制也不需要注册，可以由任何进程使用\end{cases}\end{cases}
$$
<img src="https://cdn.jsdelivr.net/gh/Holmes233666/gitee-image@main/pictureStore/image-20211208163731421.png" alt="image-20211208163731421" style="zoom:50%;" />

#### 1.1.4 套接字地址

进程到进程传递需要两个标识符：IP地址和端口号。

套接字地址Socket Address：IP地址和端口号的结合。
$$
\begin{cases}客户套接字：唯一定义了客户机进程\\服务器套接字：唯一定义了服务器进程\end{cases}
$$
传输层协议需要一对套接字地址：**客户机套接字地址**和**服务器套接字地址**。

IP头部：IP地址

UDP/TCP头部：端口号

### 1.2 无连接的服务和面向连接的服务

传输层协议可以是无连接的或者是面向连接的服务。

#### 1.2.1 面向无连接的服务

分组从一方发给另一方，不需要建立连接和释放连接。

隐患：分组没有编号。可能延迟，丢失，无序到达。无确认过程。

UDP是无连接的。

#### 1.2.2 面向连接的服务

面向连接的服务中，在发送方和接收方之间**建立**一个**连接**，然后**传送数据**，最后**释放连接**。

TCP和SCTP是面向连接的。

